<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Report l·ªói / G√≥p √Ω</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --font-main: 'Inter', sans-serif;
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --secondary-dark: #27ae60;
      --danger: #e74c3c;
      --neutral-dark: #5a6268;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --gray-light: #e9ecef;
      --white: #ffffff;
      --glass-bg: rgba(255, 255, 255, 0.2);
      --glass-border: 1px solid rgba(255, 255, 255, 0.4);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      --bg-start: #ffffff;
      --bg-end: #2193b0;
      --text-color: #212529;
      --input-bg: rgba(255, 255, 255, 0.4);
      --toggle-bg: #ffffff;
      --transition: all 0.3s ease;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    body.dark {
      --primary: #4A90E2;
      --primary-dark: #2F72B9;
      --secondary: #5cb85c;
      --secondary-dark: #449d44;
      --danger: #ff6b6b;
      --glass-bg: rgba(0, 0, 0, 0.3);
      --glass-border: 1px solid rgba(255, 255, 255, 0.1);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
      --bg-start: #1c1c1c;
      --bg-end: #000000;
      --text-color: #f0f0f0;
      --input-bg: rgba(255, 255, 255, 0.1);
      --toggle-bg: #333333;
      --light: #2c2c2c;
      --dark: #f0f0f0;
      --gray: #a0a0a0;
      --gray-light: #3c3c3c;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
      color: var(--text-color);
      transition: var(--transition);
      line-height: 1.6;
      overflow-x: hidden;
      padding: 20px;
    }

    canvas#sky {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }

    .container {
      width: 100%;
      max-width: 500px;
      z-index: 10;
    }

    .report-box {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 20px;
      border: var(--glass-border);
      box-shadow: var(--glass-shadow);
      padding: 35px;
      width: 100%;
      text-align: center;
      box-sizing: border-box;
      transition: var(--transition);
    }

    .report-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
    }

    h2 {
      margin-top: 0;
      margin-bottom: 25px;
      color: var(--text-color);
      font-weight: 700;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 15px;
    }

    h2:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--primary);
      border-radius: 3px;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
    }

    input, textarea {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: var(--input-bg);
      font-size: 15px;
      box-sizing: border-box;
      transition: var(--transition);
      color: var(--text-color);
      font-family: var(--font-main);
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    textarea { 
      height: 140px; 
      resize: none;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 25px;
    }

    button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    button:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-100%);
      transition: transform 0.3s ease;
      z-index: 0;
    }

    button:hover:before {
      transform: translateY(0);
    }

    .send-btn {
      background: var(--primary);
      color: white;
      border: 2px solid transparent;
    }

    .send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    .feedback-btn {
      background: var(--secondary);
      color: white;
      border: 2px solid transparent;
    }

    .feedback-btn:hover {
      background: var(--secondary-dark);
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    .back-btn {
      background: transparent;
      color: var(--text-color);
      border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.02);
    }

    .top-bar {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      gap: 10px;
    }

    .toggle-btn {
      background: var(--toggle-bg);
      color: var(--text-color);
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toggle-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .modal {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      z-index: 9999;
      padding: 20px;
    }

    .modal-content {
      background: var(--light);
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      color: var(--dark);
      max-width: 400px;
      width: 100%;
      box-shadow: var(--shadow-hover);
      transform: scale(0.7);
      opacity: 0;
      transition: var(--transition);
    }

    .modal.show .modal-content {
      transform: scale(1);
      opacity: 1;
    }

    .modal-content.success { 
      border-left: 6px solid var(--secondary); 
    }
    
    .modal-content.error { 
      border-left: 6px solid var(--danger); 
    }

    .modal button {
      margin-top: 15px;
      padding: 10px 20px;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      width: auto;
    }

    .modal button:hover {
      background: var(--primary-dark);
    }

    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .report-box { 
        padding: 25px; 
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      .top-bar {
        top: 15px;
        right: 15px;
      }
      
      .toggle-btn {
        padding: 8px 12px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      
      .report-box { 
        padding: 20px; 
      }
      
      h2 {
        font-size: 1.3rem;
        margin-bottom: 20px;
      }
      
      .form-group {
        margin-bottom: 15px;
      }
      
      input, textarea {
        padding: 12px;
      }
      
      button {
        padding: 12px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <canvas id="sky"></canvas>
  
  <div class="top-bar">
    <button class="toggle-btn" id="toggleTheme">
      <span class="theme-icon">üåô</span>
      <span class="theme-text">Dark Mode</span>
    </button>
  </div>

  <div class="container">
    <div class="report-box">
      <h2>üì¢ G·ª≠i th√¥ng tin</h2>
      
      <div class="form-group">
        <label for="name">T√™n c·ªßa b·∫°n</label>
        <input type="text" id="name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." required>
      </div>
      
      <div class="form-group">
        <label for="message">N·ªôi dung</label>
        <textarea id="message" placeholder="Nh·∫≠p g√≥p √Ω, b√°o l·ªói ho·∫∑c ƒë·ªÅ xu·∫•t t√≠nh nƒÉng..." required></textarea>
      </div>
      
      <div class="button-group">
        <button class="send-btn" id="sendReport">
          <span>üêû</span>
          <span>G·ª≠i Report L·ªói</span>
        </button>
        
        <button class="feedback-btn" id="sendFeedback">
          <span>üí°</span>
          <span>G·ª≠i G√≥p √Ω / ƒê·ªÅ xu·∫•t</span>
        </button>
        
        <button class="back-btn" id="backBtn">
          <span>‚¨ÖÔ∏è</span>
          <span>Quay l·∫°i trang ch√≠nh</span>
        </button>
      </div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div id="modalContent" class="modal-content">
      <p id="modalMessage">Th√¥ng b√°o</p>
      <button id="closeModal">ƒê√≥ng</button>
    </div>
  </div>

<script>
// ====== D√ÅN URL WEB APP C·ª¶A B·∫†N ·ªû ƒê√ÇY ======
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwODmbIW4ygI_7jrXF2IKWzrZmBmfAitZyaM4RsxbwRwz5v2r_3BS8ZYjxhWlr14nEe/exec";
// ===========================================

// üåå Hi·ªáu ·ª©ng b·∫ßu tr·ªùi
const canvas = document.getElementById("sky");
const ctx = canvas.getContext("2d");
let stars = [];
let meteors = [];
let meteorInterval = null;
let animationId = null;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  initStars();
}

function initStars() {
  stars = [];
  const starCount = Math.floor((canvas.width * canvas.height) / 3000);
  for (let i = 0; i < starCount; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.5,
      opacity: Math.random()
    });
  }
}

function createMeteor() {
  meteors.push({
    x: Math.random() * canvas.width,
    y: Math.random() * (canvas.height / 2),
    length: Math.random() * 80 + 40,
    speed: Math.random() * 12 + 8,
    opacity: 1
  });
}

function drawSky() {
  const isDark = document.body.classList.contains("dark");
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  if (isDark) {
    // Draw dark sky
    ctx.fillStyle = "#0f172a";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw stars
    for (let s of stars) {
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
      ctx.fill();
    }
    
    // Draw meteors
    for (let i = meteors.length - 1; i >= 0; i--) {
      const m = meteors[i];
      ctx.strokeStyle = `rgba(255, 255, 255, ${m.opacity})`;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(m.x, m.y);
      ctx.lineTo(m.x - m.length, m.y - m.length);
      ctx.stroke();
      
      m.x += m.speed;
      m.y += m.speed;
      m.opacity -= 0.05;
      
      if (m.opacity <= 0) {
        meteors.splice(i, 1);
      }
    }
    
    // Create meteors periodically
    if (meteorInterval === null) {
      meteorInterval = setInterval(createMeteor, 1200);
    }
  } else {
    // Clear meteors and interval for light mode
    if (meteorInterval !== null) {
      clearInterval(meteorInterval);
      meteorInterval = null;
      meteors.length = 0;
    }
  }
  
  animationId = requestAnimationFrame(drawSky);
}

// Initialize sky
window.addEventListener("resize", resizeCanvas);
resizeCanvas();
drawSky();

// üåó Chuy·ªÉn ch·∫ø ƒë·ªô s√°ng/t·ªëi
function applyThemeFromStorage() {
  const theme = localStorage.getItem("theme");
  if (theme === "dark") {
    document.body.classList.add("dark");
    updateThemeToggle(true);
  }
}

function updateThemeToggle(isDark) {
  const icon = document.querySelector(".theme-icon");
  const text = document.querySelector(".theme-text");
  
  if (isDark) {
    icon.textContent = "‚òÄÔ∏è";
    text.textContent = "Light Mode";
  } else {
    icon.textContent = "üåô";
    text.textContent = "Dark Mode";
  }
}

function toggleMode() {
  const isDark = document.body.classList.contains("dark");
  
  if (isDark) {
    document.body.classList.remove("dark");
    localStorage.setItem("theme", "light");
    updateThemeToggle(false);
  } else {
    document.body.classList.add("dark");
    localStorage.setItem("theme", "dark");
    updateThemeToggle(true);
  }
}

document.getElementById("toggleTheme").addEventListener("click", toggleMode);
applyThemeFromStorage();

// üì® G·ª≠i d·ªØ li·ªáu
async function sendData(type) {
  const name = document.getElementById("name").value.trim();
  const msg = document.getElementById("message").value.trim();
  
  if (!name || !msg) {
    showModal("‚ö†Ô∏è Vui l√≤ng nh·∫≠p c·∫£ t√™n v√† n·ªôi dung!", true);
    return;
  }
  
  const btn = type === 'report' ? document.getElementById("sendReport") : document.getElementById("sendFeedback");
  const originalContent = btn.innerHTML;
  
  // Disable button and show loading state
  btn.disabled = true;
  btn.innerHTML = '<span class="loader"></span> ƒêang g·ª≠i...';
  
  try {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 15000); // 15s timeout
    
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ name, message: msg, type }),
      signal: controller.signal
    });
    
    clearTimeout(timeoutId);
    
    if (res.ok) {
      const response = await res.json();
      if (response.status === "success") {
        showModal(type === "report" ? "‚úÖ Report ƒë√£ ƒë∆∞·ª£c g·ª≠i!" : "‚úÖ G√≥p √Ω ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
        document.getElementById("name").value = "";
        document.getElementById("message").value = "";
      } else {
        showModal("‚ùå L·ªói server: " + (response.message || "Ki·ªÉm tra l·∫°i Apps Script!"), true);
      }
    } else {
      showModal("‚ùå L·ªói m·∫°ng (HTTP " + res.status + ")", true);
    }
  } catch (error) {
    showModal("‚ùå L·ªói khi g·ª≠i: " + error.message, true);
    console.error("Error sending data:", error);
  } finally {
    // Re-enable button and restore original content
    btn.disabled = false;
    btn.innerHTML = originalContent;
  }
}

function showModal(message, isError = false) {
  const modal = document.getElementById("modal");
  const content = document.getElementById("modalContent");
  const messageEl = document.getElementById("modalMessage");
  
  messageEl.textContent = message;
  content.className = "modal-content " + (isError ? "error" : "success");
  
  modal.style.display = "flex";
  
  // Trigger animation
  setTimeout(() => {
    modal.classList.add("show");
  }, 10);
}

function closeModal() {
  const modal = document.getElementById("modal");
  modal.classList.remove("show");
  
  setTimeout(() => {
    modal.style.display = "none";
  }, 300);
}

function goHome() {
  window.location.href = "index.html";
}

// Event listeners
document.getElementById("sendReport").addEventListener("click", () => sendData('report'));
document.getElementById("sendFeedback").addEventListener("click", () => sendData('feedback'));
document.getElementById("backBtn").addEventListener("click", goHome);
document.getElementById("closeModal").addEventListener("click", closeModal);

// Close modal when clicking outside
document.getElementById("modal").addEventListener("click", (e) => {
  if (e.target.id === "modal") {
    closeModal();
  }
});

// Handle page visibility change to optimize performance
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    // Page is hidden, pause animations
    if (animationId) {
      cancelAnimationFrame(animationId);
      animationId = null;
    }
  } else {
    // Page is visible again, resume animations
    drawSky();
  }
});
</script>
</body>
</html>