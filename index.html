<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>B·∫£ng Th√¥ng B√°o BTVN - 22/9/2025</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #f0f8ff;
      --card: #fff;
      --text: #333;
      --accent: #0066cc;
      --note-bg: #fff3cd;
      --note-border: #ff9900;
    }
    body {
      margin: 16px;
      font-family: "Arial", sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background .25s, color .25s;
    }

    /* dark */
    body.dark {
      --bg: #0f0f10;
      --card: #161617;
      --text: #e8eefc;
      --accent: #66b2ff;
      --note-bg: #3a2e00;
      --note-border: #ffcc00;
    }

    /* Menu */
    .menu {
      position: fixed;
      top: 18px;
      right: 18px;
      z-index: 1200;
    }
    .menu-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }
    .menu-panel {
      display: none;
      position: absolute;
      top: 44px;
      right: 0;
      width: 210px;
      background: var(--card);
      border-radius: 8px;
      box-shadow: 0 8px 28px rgba(0,0,0,.25);
      overflow: hidden;
    }
    .menu-panel button {
      display: block;
      width: 100%;
      padding: 10px 12px;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      color: var(--text);
    }
    .menu-panel button:hover { background: rgba(0,0,0,.04); }
    body.dark .menu-panel button:hover { background: rgba(255,255,255,.02); }

    /* popup */
    .popup {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.45);
      z-index: 1100;
      align-items: center;
      justify-content: center;
    }
    .popup.open { display: flex; }
    .popup-card {
      width: 360px;
      max-width: calc(100% - 40px);
      background: var(--card);
      color: var(--text);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position: relative;
    }
    .popup-card .close {
      position: absolute;
      right: 10px; top: 8px;
      cursor: pointer;
      font-size: 18px;
      opacity: .85;
    }

    /* layout: two column on wide screens */
    .wrap {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1200px;
      margin: 80px auto 40px;
    }
    @media(min-width:900px){
      .wrap { flex-direction: row; align-items: flex-start; }
    }

    .card {
      background: var(--card);
      color: var(--text);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,.12);
    }
    .card.half { width: 100%; }
    @media(min-width:900px){
      .card.half { width: 48%; }
    }

    h1 { color: var(--accent); margin: 6px 0 12px; text-align:center; }
    h2 { margin: 10px 0; color: var(--text); border-left: 6px solid var(--accent); padding-left:10px; }

    .note {
      background: var(--note-bg);
      border-left: 6px solid var(--note-border);
      padding: 10px 12px;
      border-radius: 8px;
      color: inherit;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid rgba(0,0,0,.15);
      padding: 8px 10px;
      text-align: left;
    }
    th { background: rgba(0,0,0,.04); color: var(--accent); font-weight:700; }
    tr:nth-child(even) td { background: rgba(0,0,0,.03); }
    body.dark th { background: rgba(0,0,0,.22); }
    body.dark tr:nth-child(even) td { background: rgba(255,255,255,.02); }
    body.dark td { border-color: rgba(255,255,255,.06); }

    #showFullBtn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 12px;
    }
    #showFullBtn:hover { opacity: .95; }

    /* report fixed */
    #reportFixed {
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: #ff4d4d;
      color: #fff;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,.2);
      z-index: 1000;
    }

    /* small styling for "editable" */
    .editable {
      padding: 4px 6px;
      border-radius: 6px;
      background: rgba(0,0,0,0.02);
      display:inline-block;
      cursor:text;
    }
    .save-truc {
      display:inline-block;
      margin-left:8px;
      padding:4px 8px;
      border-radius:6px;
      background:var(--accent);
      color:white;
      border:none;
      cursor:pointer;
    }
    .inline-note { margin-top:10px; display:block; color: rgba(0,0,0,.6); }
    body.dark .inline-note { color: rgba(255,255,255,.6); }

  </style>
</head>
<body>
  <!-- MENU -->
  <div class="menu" aria-hidden="false">
    <button class="menu-btn" id="menuBtn">‚ò∞ Menu</button>
    <div class="menu-panel" id="menuPanel" role="menu" aria-hidden="true">
      <button id="menuDark">üåô Chuy·ªÉn Dark/Light</button>
      <button id="menuReport">üö® Report</button>
      <button id="menuPopup">üîî B·∫≠t l·∫°i th√¥ng b√°o</button>
    </div>
  </div>

  <!-- POPUP -->
  <div class="popup" id="popup">
    <div class="popup-card" id="popupCard">
      <div class="close" id="popupClose" title="ƒê√≥ng">‚úï</div>
      <h3>‚ùóL∆∞u √Ω</h3>
      <p id="popupText">ƒê∆∞·ª£c l√†m ra v√† ph√°t tri·ªÉn b·ªüi ChatGBT(Web), V≈© Duy Anh v√† Nguy·ªÖn VƒÉn Ho√†ng B√°ch</p>
      <p id="popupText">Trang web hi·ªán ƒëang trong giai ƒëo·∫°n ph√°t tri·ªÉn Beta s·∫Ω r·∫•t d·ªÖ ƒë·ªÉ l·∫°i sai s√≥t</p>
      <p style="margin-top:12px; text-align:left;">
        <label><input type="checkbox" id="dontShowToday"/> Kh√¥ng hi·ªÉn th·ªã l·∫°i h√¥m nay</label>
      </p>
    </div>
  </div>

  <!-- MAIN -->
  <div class="wrap">
    <!-- BTVN -->
    <div class="card">
      <h1>üì¢ Th√¥ng b√°o BTVN [NEW 02:00 - 22/9/2025]</h1>

      <h2>üìò ƒê·ªãa l√≠</h2>
      <ul><li>T√¨m hi·ªÉu d·∫°ng ƒë·ªãa h√¨nh C√°c-xt∆° v√† h·ªçc thu·ªôc(Ch∆∞a r√µ l√† c√≥ c·∫ßn h·ªçc thu·ªôc kh√¥ng!)</li></ul>

      <h2>‚ûó To√°n h·ªçc</h2>
      <strong>H√¨nh:</strong>
      <ul><li>H·ªçc ƒë·ªãnh nghƒ©a h√¨nh thang, h√¨nh thang c√¢n</li></ul>
      <strong>S·ªë:</strong>
      <ul>
        <li>1.14 ‚Üí 1.17 S√°ch to√°n t·∫≠p 1 [SGK-52; 53]</li>
        <li>H·ªçc thu·ªôc quy t·∫Øc c·ªông, tr·ª´ ƒëa th·ª©c [SGK-15]</li>
      </ul>

      <h2>‚úç Ng·ªØ vƒÉn</h2>
      <ul><li>Vi·∫øt k·∫øt n·ªëi v·ªõi ƒë·ªçc SGK-24</li></ul>

      <h2>üß¨ Sinh h·ªçc</h2>
      <ul><li>H·ªçc ph·∫ßn I v√† II</li><li>ƒê·ªçc tr∆∞·ªõc Qu√° tr√¨nh ti√™u h√≥a</li></ul>

      <h2>üè† GDƒêP</h2>
      <ul><li>Ch∆∞a c√≥ b√†i</li></ul>

      <h2>üìú L·ªãch s·ª≠</h2>
      <ul><li>L√†m b√†i 1 ph·∫ßn Luy·ªán t·∫≠p v√† v·∫≠n d·ª•ng [SGK-14]. L∆∞u √Ω nh·ªè: l√†m ra v·ªü c∆∞∆°ng!</li></ul>

      <h2>üî¨ V·∫≠t l√Ω</h2>
      <ul><li>H·ªçc c√¥ng th·ª©c, kh√°i ni·ªám v·ªÅ tr·ªçng l∆∞·ª£ng ri√™ng</li></ul>

      <h2>ü§ù HƒêTN, HN</h2>
      <ul><li>V·∫Ω tranh ho·∫∑c l√†m th∆° ch·ªß ƒë·ªÅ b·∫•t k√¨ ƒë·ªëi v·ªõi th∆° tranh ch·ªß ƒë·ªÅ truy·ªÅn th·ªëng tr∆∞·ªùng t·ªët ƒë·∫πp[th·ª© s√°u n·ªôp]</li></ul>

      <h2>üé® Mƒ© thu·∫≠t</h2>
      <ul><li>V·∫Ω xong b√†i c√¥ ƒë√£ cho</li></ul>

      <h2>‚öó H√≥a h·ªçc</h2>
      <ul><li>Hi·ªán ch∆∞a r√µ</li></ul>

      <h2>üá¨üáß Ti·∫øng Anh</h2>
      <ul><li>Vi·∫øt 12 t·ª´ m·ªõi m·ªói t·ª´ 20 l·∫ßn m·ªói d√≤ng hai l·∫ßn</li></ul>

      <h2>üë• C√¥ng d√¢n</h2>
      <ul><li>H·ªçc ph·∫ßn 3 khung v√†ng(SGK - trang 8)</li><li>L√†m b√†i 1 ƒë·∫øn 4 (SGK trang 8 v√† 9)</li></ul>

      <h2>üîß C√¥ng ngh·ªá</h2>
      <ul><li>Ch∆∞a c√≥ b√†i</li></ul>

      <h2>üé∂ √Çm nh·∫°c</h2>
      <ul><li>H·ªçc b√†i h√°t "kh√∫c ca b·ªën m√πa"</li></ul>

      <h2>üíª Tin h·ªçc</h2>
      <ul><li>H·ªçc h·∫øt c√°c th·∫ø h·ªá m√°y t√≠nh</li><li>L√†m h·∫øt b√†i t·∫≠p SGK-6; 8</li></ul>

      <div class="note">
        <strong>L∆ØU √ù:</strong>
        <ul>
        <li>Mu·ªën b√°o l·ªói ho·∫∑c g√≥p √Ω vui l√≤ng nh·∫≠p b·∫•m n√∫t report nh·∫≠p th√¥ng tin b·∫°n mu·ªën b√°o(H√£y ƒë·ªÉ t√™n b·∫°n ·ªü cu·ªëi v√† ƒë√≥ng ngo·∫∑c ghi ƒë√≥ l√† g√≥p √Ω hay b√°o l·ªói ·ªü ƒë·∫ßu ti√™n)</li>
        <li>Th∆∞·ªùng ho·∫°t ƒë·ªông: 11h50 ‚Äì 13h00; 17h00 ‚Äì 20h45</li>
        <li>Th√¥ng tin c√≥ th·ªÉ ch∆∞a ch√≠nh x√°c, vui l√≤ng ki·ªÉm tra l·∫°i</li>
        <li>M·ª•c ƒë√≠ch: t·ªët cho m·ªçi ng∆∞·ªùi ‚Üí n·∫øu sai s√≥t xin b√°o l·∫°i, kh√¥ng ch·ª≠i t·ª•c</li>
        <li>B·∫°n ƒë·ªçc hay kh√¥ng l√† quy·ªÅn c·ªßa b·∫°n, kh√¥ng v·ª´a √Ω vui l√≤ng t√¨m ngu·ªìn kh√°c</li>
        <li>S√°ch kh√¥ng ghi c√°ch di·ªÅu hay k·∫øt n·ªëi chi th·ª©c th√¨ n·∫∑c ƒë·ªãnh n√≥ l√† k·∫øt n·ªëi chi th·ª©c</li>
        </ul>
      </div>

      <div class="changelog" style="margin-top:14px;">
        <strong>Changelog (V2.3.2)</strong>
        <ul>
          <li>C·∫≠p nh·∫≠t To√°n h·ªçc [S·ªë]</li>
          <li>C·∫≠p nh·∫≠t L·ªãch s·ª≠</li>
          <li>C·∫≠p nh·∫≠t ƒê·ªãa l√≠</li>
          <li>C·∫≠p nh·∫≠t Ti·∫øng Anh</li>
          <li>Th√™m th√¥ng b√°o l·ªãch tr·ª±c [Beta]</li>
          <li>Th√™m 07:00 TKB v√† LT m·ªõi ƒë·ªïi</li>
          <li>S·ª≠a v√†i th·ª© kh√°c</li>
          <li>S·ª≠a ƒë·ªïi giao di·ªán g·ªçn h∆°n cho web PC</li>
          <li>S·ª≠a ƒë·ªïi l·ªãch tr·ª±c nh·∫≠t v√† TKB s·∫Ω ·ªü d∆∞·ªõi c√πng khi d√πng ƒëi·ªán tho·∫°i</li>
          <li>S·ª≠a ƒë·ªïi v·ªã tr√≠ c√°c n√∫t</li>
        </ul>
      </div>
    </div>
    <!-- TKB card -->
    <div class="card half" id="tkbCard">
      <h2>üìÖ Th·ªùi kh√≥a bi·ªÉu v√† l·ªãch tr·ª±c nh·∫≠t ng√†y mai</h2>

      <div id="todayTKB">ƒêang t·∫£i...</div>

      <button id="showFullBtn">üìÖ Xem to√†n b·ªô TKB & L·ªãch tr·ª±c</button>

      <div id="fullTKB" style="display:none; margin-top:14px;"></div>
    </div>
  </div>

  <!-- report fixed -->
  <button id="reportFixed">üö® Report</button>

  <script>
    /* -------------------------
       Config / d·ªØ li·ªáu m·∫∑c ƒë·ªãnh
       ------------------------- */
    const API_URL = "https://script.google.com/macros/s/AKfycbw5sjUwJfwRtKBQQu5FgYrmgSjoQ22vvnmlv99H7YJHTVgVZRXm1vWB7fFJg8B2O2M7/exec";

    const TKB = {
        0: ["Ch·ªß nh·∫≠t: Ngh·ªâ / T·ª± h·ªçc"],
        1: ["HƒêTN,HN", "LS&ƒêL - S·ª≠", "Anh", "LS&ƒêL - ƒê·ªãa", "To√°n - S·ªë"],
        2: ["VƒÉn", "Anh", "C√¥ng ngh·ªá", "HƒêTN,HN", "GDTC"],
        3: ["VƒÉn", "To√°n - H√¨nh", "KHTN - L√Ω", "NT - Mƒ© thu·∫≠t", "KHTN - Sinh"],
        4: ["To√°n - S·ªë", "Tin", "LS&ƒêL - S·ª≠", "√Çm nh·∫°c", "Anh"],
        5: ["GDƒêP", "VƒÉn", "HƒêTN,HN", "To√°n", "C√¥ng d√¢n"],
        6: ["KHTN - Sinh", "GDTC", "VƒÉn", "KHTN - H√≥a", "Ngh·ªâ"]
    };

    // L·ªãch tr·ª±c (c√≥ l∆∞u localStorage n·∫øu user ch·ªânh)
    let truc = JSON.parse(localStorage.getItem('lichTruc') || 'null') || {
        0: "Ch·ªß nh·∫≠t: Kh√¥ng tr·ª±c",
        1: "T·ªï 2",
        2: "T·ªï 3",
        3: "T·ªï 4",
        4: "T·ªï 1",
        5: "T·ªï 2",
        6: "T·ªï 3",
    };

    const dayNames = ["Ch·ªß Nh·∫≠t","Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Th·ª© NƒÉm","Th·ª© S√°u","Th·ª© B·∫£y"];

    /* -------------------------
       Menu
       ------------------------- */
    const menuBtn = document.getElementById('menuBtn');
    const menuPanel = document.getElementById('menuPanel');

    menuBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      menuPanel.style.display = menuPanel.style.display === 'block' ? 'none' : 'block';
    });
    window.addEventListener('click', (ev) => {
      if (!menuPanel.contains(ev.target) && ev.target !== menuBtn) menuPanel.style.display = 'none';
    });

    // Dark toggle in menu:
    const menuDark = document.getElementById('menuDark');
    function applyThemeFromStorage(){
      if (localStorage.getItem('theme') === 'dark'){
        document.body.classList.add('dark');
        menuDark.textContent = '‚òÄÔ∏è Light Mode';
      } else {
        document.body.classList.remove('dark');
        menuDark.textContent = 'üåô Dark Mode';
      }
    }
    applyThemeFromStorage();
    menuDark.addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      applyThemeFromStorage();
    });

    // Report from menu & fixed button
    const menuReport = document.getElementById('menuReport');
    const reportFixed = document.getElementById('reportFixed');

    async function doReport(){
      const txt = prompt("‚ùóNh·∫≠p n·ªôi dung b√°o l·ªói / g√≥p √Ω:");
      if (!txt || !txt.trim()) { alert("‚ö†Ô∏è B·∫°n ch∆∞a nh·∫≠p n·ªôi dung."); return; }
      try {
        // g·ª≠i l√™n API n·∫øu b·∫°n c√≥ deploy; n·∫øu kh√¥ng c√≥ th√¨ th·ª≠-catch v·∫´n ok
        await fetch(API_URL, { method: 'POST', body: JSON.stringify({ text: txt }) });
        alert("‚úÖ ƒê√£ g·ª≠i. C·∫£m ∆°n b·∫°n!");
      } catch(e){
        console.warn('Report failed (demo):', e);
        alert("‚úÖ (Demo) ƒê√£ ghi nh·∫≠n: " + txt);
      }
    }
    menuReport.addEventListener('click', doReport);
    reportFixed.addEventListener('click', doReport);

    // Show popup from menu
    document.getElementById('menuPopup').addEventListener('click', () => {
      openPopup(true);
      menuPanel.style.display = 'none';
    });

    /* -------------------------
       Popup logic (1 l·∫ßn/ng√†y + "Kh√¥ng hi·ªán h√¥m nay")
       ------------------------- */
    const popup = document.getElementById('popup');
    const popupClose = document.getElementById('popupClose');
    const dontShowTodayChk = document.getElementById('dontShowToday');

    function openPopup(force=false){
      const today = new Date().toLocaleDateString('vi-VN');
      const disabled = localStorage.getItem('popupDisabled') === 'true'; // n·∫øu user t·∫Øt ho√†n to√†n (kh√¥ng d√πng ·ªü ƒë√¢y)
      if (force) {
        popup.classList.add('open');
        return;
      }
      if (disabled) return;
      const lastShown = localStorage.getItem('popupShownDate');
      if (lastShown !== today){
        popup.classList.add('open');
        localStorage.setItem('popupShownDate', today);
      }
    }

    popupClose.addEventListener('click', () => {
      if (dontShowTodayChk.checked){
        localStorage.setItem('popupShownDate', new Date().toLocaleDateString('vi-VN'));
      }
      popup.classList.remove('open');
    });

    // show on load
    window.addEventListener('load', () => openPopup(false) );

    /* -------------------------
       TKB rendering + full view + editing tr·ª±c
       ------------------------- */
    function computeShowDay(){
      // L·∫•y gi·ªù VN
      const vnNow = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Ho_Chi_Minh' }));
    }

    // NOTE: small helper: get VN date/time (works cross-browser)
    function getVNDateObj(){
      const s = new Date().toLocaleString('en-US', { timeZone: 'Asia/Ho_Chi_Minh' });
      return new Date(s);
    }

    function renderTodayTKB(){
      const d = getVNDateObj();
      let day = d.getDay(); // 0..6
      const hour = d.getHours();

      // n·∫øu tr∆∞·ªõc 7h th√¨ coi nh∆∞ ng√†y h√¥m tr∆∞·ªõc
      if (hour < 7) day = (day - 1 + 7) % 7;

      // logic hi·ªÉn th·ªã: Th·ª© S√°u -> hi·ªán Th·ª© B·∫£y; Ch·ªß Nh·∫≠t -> hi·ªán Th·ª© Hai; kh√°c -> ng√†y mai
      let showDay;
      if (day === 5) showDay = 6;
      else if (day === 0) showDay = 1;
      else showDay = (day + 1) % 7;

      const container = document.getElementById('todayTKB');
      let html = `<p>H√¥m nay: <strong>${dayNames[d.getDay()]}</strong>, ${d.toLocaleDateString('vi-VN')} ‚Äî Hi·ªÉn th·ªã TKB <strong>${dayNames[showDay]}</strong></p>`;
      html += `<div class="inline-note">‚ùóL∆∞u √Ω: Sau 7:00 s√°ng TKB & l·ªãch tr·ª±c s·∫Ω chuy·ªÉn sang ng√†y ti·∫øp theo (m·ªôt v√†i quy t·∫Øc ƒë·∫∑c bi·ªát ƒë∆∞·ª£c √°p d·ª•ng).</div>`;
      html += `<table><thead><tr><th>Ti·∫øt</th><th>M√¥n / N·ªôi dung</th></tr></thead><tbody>`;
      (TKB[showDay] || []).forEach((m,i) => {
        html += `<tr><td>${i+1}</td><td>${m}</td></tr>`;
      });
      html += `</tbody></table>`;
      html += `<p style="margin-top:10px;"><b>L·ªãch tr·ª±c: </b> <span id="todayTruc">${truc[showDay]}</span>`;

      container.innerHTML = html;

      // handle edit tr·ª±c: m·ªü prompt -> l∆∞u v√†o truc v√† localStorage (ch·ªâ admin)
      document.getElementById('editTrucBtn').addEventListener('click', ()=>{
        const txt = prompt("S·ª≠a ghi ch√∫ l·ªãch tr·ª±c cho ng√†y hi·ªÉn th·ªã:", truc[showDay]);
        if (txt !== null){
          truc[showDay] = txt;
          localStorage.setItem('lichTruc', JSON.stringify(truc));
          renderTodayTKB(); // rerender ƒë·ªÉ c·∫≠p nh·∫≠t
        }
      });
    }
    // full week + inline ch·ªânh tr·ª±c c·ªßa t·ª´ng ng√†y
    document.getElementById('showFullBtn').addEventListener('click', function(){
      const full = document.getElementById('fullTKB');
      if (full.style.display === 'block'){
        full.style.display = 'none';
        this.textContent = 'üìÖ Xem to√†n b·ªô TKB & L·ªãch tr·ª±c';
        return;
      }
      // build full
      let html = `<div style="margin-bottom:8px;"><strong>üìÖ Th·ªùi kh√≥a bi·ªÉu c·∫£ tu·∫ßn</strong></div>`;
      for (let k=1;k<=6;k++){
        html += `<h3 style="margin:8px 0 4px;">${dayNames[k]}</h3>`;
        html += `<table><thead><tr><th>Ti·∫øt</th><th>M√¥n</th></tr></thead><tbody>`;
        (TKB[k] || []).forEach((m,i)=> html += `<tr><td>${i+1}</td><td>${m}</td></tr>`);
        html += `</tbody></table>`;
      }

      // m·ªôt b·∫£ng ri√™ng cho l·ªãch tr·ª±c
      html += `<hr style="opacity:.08;margin:12px 0;"><h3>üßπ L·ªãch tr·ª±c c·∫£ tu·∫ßn</h3>`;
      html += `<table><thead><tr><th>Ng√†y</th><th>T·ªï tr·ª±c</th></tr></thead><tbody>`;
      for (let k=1;k<=6;k++){
        html += `<tr><td>${dayNames[k]}</td><td class="editable-truc" data-day="${k}">${truc[k]}</td></tr>`;
      }
      html += `</tbody></table>`;

      full.innerHTML = html;
      full.style.display = 'block';
      this.textContent = '‚ùå ·∫®n to√†n b·ªô';

      // make editable spans clickable -> prompt edit
      full.querySelectorAll('.editable-truc').forEach(el=>{
        el.style.cursor = 'pointer';
        el.addEventListener('click', ()=>{
          const day = el.dataset.day;
          const val = prompt("S·ª≠a l·ªãch tr·ª±c cho " + dayNames[day], truc[day]);
          if (val !== null){
            truc[day] = val;
            localStorage.setItem('lichTruc', JSON.stringify(truc));
            // c·∫≠p nh·∫≠t UI (c·∫£ ph·∫ßn full v√† today)
            el.textContent = val;
            renderTodayTKB();
          }
        });
      });

      // save buttons
      full.querySelectorAll('.save-truc').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const day = btn.dataset.day;
          const val = prompt("Nh·∫≠p n·ªôi dung tr·ª±c cho " + dayNames[day], truc[day]);
          if (val !== null){
            truc[day] = val;
            localStorage.setItem('lichTruc', JSON.stringify(truc));
            renderTodayTKB();
            // refresh full view
            document.getElementById('showFullBtn').click();
            document.getElementById('showFullBtn').click();
          }
        });
      });
    });

    // init render
    renderTodayTKB();

    // re-render every minute (keeps up-to-date at 7:00 change)
    setInterval(renderTodayTKB, 60*1000);

    /* -------------------------
      Small accessibility: close menu with ESC
    ------------------------- */
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') {
        document.getElementById('menuPanel').style.display = 'none';
        document.getElementById('popup').classList.remove('open');
      }
    });
  </script>
</body>
</html>
