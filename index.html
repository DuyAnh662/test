<!DOCTYPE html>
<html lang="vi">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-92KE83JEYM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-92KE83JEYM');
    </script>
    <meta charset="utf-8" />
    <title>Bảng Thông Báo BTVN - 26/9/2025</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root {
            --bg: #f0f8ff;
            --card: #fff;
            --text: #333;
            --accent: #0066cc;
            --note-bg: #fff3cd;
            --note-border: #ff9900;
        }
        
        body {
            margin: 16px;
            font-family: "Arial", sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background .25s, color .25s;
        }
        /* dark */
        
        body.dark {
            --bg: #0f0f10;
            --card: #161617;
            --text: #e8eefc;
            --accent: #66b2ff;
            --note-bg: #3a2e00;
            --note-border: #ffcc00;
        }
        /* Menu */
        
        .menu {
            position: fixed;
            top: 18px;
            right: 18px;
            z-index: 1200;
        }
        
        .menu-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .15);
        }
        
        .menu-panel {
            display: none;
            position: absolute;
            top: 44px;
            right: 0;
            width: 210px;
            background: var(--card);
            border-radius: 8px;
            box-shadow: 0 8px 28px rgba(0, 0, 0, .25);
            overflow: hidden;
        }
        
        .menu-panel button {
            display: block;
            width: 100%;
            padding: 10px 12px;
            border: none;
            background: transparent;
            text-align: left;
            cursor: pointer;
            color: var(--text);
        }
        
        .menu-panel button:hover {
            background: rgba(0, 0, 0, .04);
        }
        
        body.dark .menu-panel button:hover {
            background: rgba(255, 255, 255, .02);
        }
        /* popup */
        
        .popup {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .45);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }
        
        .popup.open {
            display: flex;
        }
        
        .popup-card {
            width: 360px;
            max-width: calc(100% - 40px);
            background: var(--card);
            color: var(--text);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
            position: relative;
        }
        
        .popup-card .close {
            position: absolute;
            right: 10px;
            top: 8px;
            cursor: pointer;
            font-size: 18px;
            opacity: .85;
        }
        /* layout: two column on wide screens */
        
        .wrap {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1200px;
            margin: 80px auto 40px;
        }
        
        @media(min-width:900px) {
            .wrap {
                flex-direction: row;
                align-items: flex-start;
            }
        }
        
        .card {
            background: var(--card);
            color: var(--text);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .12);
        }
        
        .card.half {
            width: 100%;
        }
        
        @media(min-width:900px) {
            .card.half {
                width: 48%;
            }
        }
        
        h1 {
            color: var(--accent);
            margin: 6px 0 12px;
            text-align: center;
        }
        
        h2 {
            margin: 10px 0;
            color: var(--text);
            border-left: 6px solid var(--accent);
            padding-left: 10px;
        }
        
        .note {
            background: var(--note-bg);
            border-left: 6px solid var(--note-border);
            padding: 10px 12px;
            border-radius: 8px;
            color: inherit;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th,
        td {
            border: 1px solid rgba(0, 0, 0, .15);
            padding: 8px 10px;
            text-align: left;
        }
        
        th {
            background: rgba(0, 0, 0, .04);
            color: var(--accent);
            font-weight: 700;
        }
        
        tr:nth-child(even) td {
            background: rgba(0, 0, 0, .03);
        }
        
        body.dark th {
            background: rgba(0, 0, 0, .22);
        }
        
        body.dark tr:nth-child(even) td {
            background: rgba(255, 255, 255, .02);
        }
        
        body.dark td {
            border-color: rgba(255, 255, 255, .06);
        }
        
        #showFullBtn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 12px;
        }
        
        #showFullBtn:hover {
            opacity: .95;
        }
        /* report fixed */
        
        #reportFixed {
            position: fixed;
            right: 18px;
            bottom: 18px;
            background: #ff4d4d;
            color: #fff;
            padding: 10px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, .2);
            z-index: 1000;
        }
        /* small styling for "editable" */
        
        .editable {
            padding: 4px 6px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.02);
            display: inline-block;
            cursor: text;
        }
        
        .save-truc {
            display: inline-block;
            margin-left: 8px;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .inline-note {
            margin-top: 10px;
            display: block;
            color: rgba(0, 0, 0, .6);
        }
        
        body.dark .inline-note {
            color: rgba(255, 255, 255, .6);
        }
        
        .changelog {
            background-color: #1e293b;
            /* nền xanh đậm */
            
            color: #e2e8f0;
            /* màu chữ sáng */
            
            border-radius: 10px;
            padding: 15px 20px;
            margin: 20px 0;
            border-left: 5px solid #60a5fa;
            /* viền xanh nhạt bên trái */
            
            font-family: Arial, sans-serif;
        }
        
        .changelog h3 {
            margin-top: 0;
            color: #ffffff;
            /* tiêu đề trắng */
        }
        
        .changelog ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        
        .changelog li {
            margin: 6px 0;
            color: #93c5fd;
            /* chữ xanh nhạt */
        }
        
        .changelog {
            border-radius: 10px;
            padding: 15px 20px;
            margin: 20px 0;
            font-family: Arial, sans-serif;
            transition: background .25s, color .25s;
        }
        /* Light mode (mặc định) */
        
        body:not(.dark) .changelog {
            background: #f8fafc;
            color: #1e293b;
            border-left: 5px solid #2563eb;
        }
        
        body:not(.dark) .changelog h3,
        body:not(.dark) .changelog strong {
            color: #111827;
        }
        
        body:not(.dark) .changelog li {
            color: #2563eb;
        }
        /* Dark mode */
        
        body.dark .changelog {
            background: #1e293b;
            color: #e2e8f0;
            border-left: 5px solid #60a5fa;
        }
        
        body.dark .changelog h3,
        body.dark .changelog strong {
            color: #ffffff;
        }
        
        body.dark .changelog li {
            color: #93c5fd;
        }
        
        .menu-panel a.donate-btn {
            display: block;
            width: 100%;
            padding: 10px 12px;
            text-align: left;
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
        }
        
        .menu-panel a.donate-btn:hover {
            background: rgba(0, 0, 0, .04);
        }
        
        body.dark .menu-panel a.donate-btn:hover {
            background: rgba(255, 255, 255, .08);
        }
        /* Popup đẹp hơn */
        
        .popup-card {
            width: 420px;
            max-width: calc(100% - 40px);
            background: var(--card);
            color: var(--text);
            padding: 22px 20px;
            border-radius: 14px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, .4);
            position: relative;
            border-top: 6px solid var(--accent);
            animation: popupIn .3s ease;
        }
        /* hiệu ứng mở */
        
        @keyframes popupIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .popup-card h3 {
            margin: 0 0 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .popup-card h3::before {
            content: "⚠️";
        }
        
        .popup-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .popup-card li {
            margin: 6px 0;
            line-height: 1.5;
        }
        
        .popup-card li strong {
            color: var(--accent);
        }
        
        .popup-card .close {
            position: absolute;
            right: 12px;
            top: 10px;
            cursor: pointer;
            font-size: 18px;
            opacity: .75;
            transition: .2s;
        }
        
        .popup-card .close:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        
        .popup-card .footer-check {
            margin-top: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            opacity: .85;
        }
        /* Popup 3D đẹp hơn */
        
        .popup-card {
            width: 420px;
            max-width: calc(100% - 40px);
            background: var(--card);
            color: var(--text);
            padding: 22px 20px;
            border-radius: 14px;
            /* Hiệu ứng 3D bằng nhiều lớp shadow */
            
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.35), 0 5px 10px rgba(0, 0, 0, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.15);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-top: 6px solid var(--accent);
            /* Gradient nhẹ để có cảm giác nổi */
            
            background: linear-gradient( 145deg, rgba(255, 255, 255, 0.03), rgba(0, 0, 0, 0.15)), var(--card);
            animation: popupIn .35s ease;
            transform: translateY(0) scale(1);
            transition: transform .2s ease, box-shadow .2s ease;
        }
        /* Hover rung động nhẹ */
        
        .popup-card:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 18px 30px rgba(0, 0, 0, 0.4), 0 8px 15px rgba(0, 0, 0, 0.25), inset 0 1px 2px rgba(255, 255, 255, 0.1);
        }
        
        @keyframes popupIn {
            from {
                transform: translateY(-20px) scale(.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <!-- MENU -->
    <div class="menu" aria-hidden="false">
        <button class="menu-btn" id="menuBtn">☰ Menu</button>
        <div class="menu-panel" id="menuPanel" role="menu" aria-hidden="true">
            <button id="menuDark">🌙 Chuyển Dark/Light</button>
            <button id="menuReport">🚨 Report</button>
            <button id="menuPopup">❗Bật lại Lưu ý</button>
            <a href="Donate.html" target="_blank" class="donate-btn">❤️ Donate to us</a>
        </div>
    </div>

    <!-- POPUP -->
    <div class="popup" id="popup">
        <div class="popup-card" id="popupCard">
            <div class="close" id="popupClose" title="Đóng">✕</div>
            <h3>❗Lưu ý</h3>
            <p id="popupText">+Được làm ra và phát triển bởi ChatGBT(Web), Vũ Duy Anh và Nguyễn Văn Hoàng Bách</p>
            <p id="popupText">+Trang web hiện đang trong giai đoạn phát triển Beta sẽ rất dễ để lại sai sót</p>
            <p id="popupText">+Donate chúng toi nhé!^_^</p>
            <p style="margin-top:12px; text-align:left;">
                <label>
                    <input type="checkbox" id="dontShowToday" /> Không hiển thị lại hôm nay</label>
            </p>
        </div>
    </div>

    <!-- MAIN -->
    <div class="wrap">
        <!-- BTVN -->
        <div class="card">
            <h1>📢 Thông báo BTVN [NEW 11:45 - 26/9/2025]</h1>

            <h2>📘 Địa lí</h2>
            <ul>
                <li>Tìm hiểu dạng địa hình Các-xtơ và học thuộc</li>
            </ul>

            <h2>➗ Toán học</h2>
            <strong>Hình:</strong>
            <ul>
                <li>Làm nốt bài thầy cho trên lớp</li>
                <li>Ôn lại bài cũ</ul>
            <strong>Số:</strong>
            <ul>
                <li>1.18 → 1.23 Sách toán tập 1 [SGK-17; 18]</li>
            </ul>

            <h2>✍ Ngữ văn</h2>
            <ul>
                <li>Hiện không có</li>
            </ul>

            <h2>🧬 Sinh học</h2>
            <ul>
                <li>Có thể sẽ kiểm tra bài 32 một số bệnh về tiêu hóa</li>
            </ul>

            <h2>🏠 GDĐP</h2>
            <ul>
                <li>Chưa có bài</li>
            </ul>

            <h2>📜 Lịch sử</h2>
            <ul>
                <li>Hiện không có bài[Chưa rõ]</li>
            </ul>

            <h2>🔬 Vật lý</h2>
            <ul>
                <li>Làm bài thầy đã đọc trên lớp</li>
            </ul>

            <h2>🤝 HĐTN, HN</h2>
            <ul>
                <li>Vẽ tranh hoặc làm thơ chủ đề bất kì đối với thơ tranh chủ đề truyền thống trường tốt đẹp[thứ sáu nộp]</li>
                <li>Lưu ý nhỏ: làm ra giấy
            </ul>

            <h2>🎨 Mĩ thuật</h2>
            <ul>
                <li>Vẽ xong bài cô đã cho</li>
            </ul>

            <h2>⚗ Hóa học</h2>
            <ul>
                <li>Hiện chưa rõ</li>
            </ul>

            <h2>🇬🇧 Tiếng Anh(Global success)</h2>
            <ul>
                <li>Làm nốt bài 4</li>
                <li>Ôn lại cách công thức</li>
            </ul>

            <h2>👥 Công dân</h2>
            <ul>
                <li>Làm vận dụng bài 2</li>
                <li>Làm bài 1 đến 4 (SGK trang 8 và 9)[Nếu chưa làm xong]</li>
                <li>Lưu ý nhỏ: Có thể sẽ chấm</li>
            </ul>

            <h2>🔧 Công nghệ</h2>
            <ul>
                <li>Chưa có bài</li>
            </ul>

            <h2>🎶 Âm nhạc(Sách cánh diều)</h2>
            <ul>
                <li>Học bài hát "Bản làng tươi đẹp"(SGK-13)</li>
            </ul>

            <h2>💻 Tin học</h2>
            <ul>
                <li>Học hết Phần 1 hoặc 2 bài 2(chưa rõ)</li>
            </ul>

            <div class="note">
                <strong>LƯU Ý:</strong>
                <ul>
                    <li>Muốn báo lỗi hoặc góp ý vui lòng nhập bấm nút menu rồi bấm report nhập thông tin bạn muốn báo(Hãy để tên bạn ở cuối và đóng ngoặc ghi đó là góp ý hay báo lỗi ở đầu tiên)</li>
                    <li>Thường hoạt động: 11h50 – 13h00; 17h00 – 20h45</li>
                    <li>Thông tin có thể chưa chính xác, vui lòng kiểm tra lại</li>
                    <li>Mục đích: tốt cho mọi người → nếu sai sót xin báo lại, không chửi tục</li>
                    <li>Bạn đọc hay không là quyền của bạn, không vừa ý vui lòng tìm nguồn khác</li>
                    <li>Sách không ghi cách diều hay kết nối chi thức thì nặc định nó là kết nối chi thức</li>
                </ul>
            </div>

            <div class="changelog" style="margin-top:14px;">
                <strong>Changelog (V2.7)</strong>
                <ul>
                    <li>Cập nhật GDCD</li>
                    <li>Cập nhật Toán học (Hình học)</li>
                    <li>Cập nhật Lịch sử</li>
                    <li>Sửa HĐTN</li>
                    <li>Cập nhật Ngữ văn</li>
                    <li>Sửa một vài thứ khác</li>
                </ul>
            </div>
        </div>
        <!-- TKB card -->
        <div class="card half" id="tkbCard">
            <h2>📅 Thời khóa biểu và lịch trực nhật ngày mai</h2>

            <div id="todayTKB">Đang tải...</div>

            <button id="showFullBtn">📅 Xem toàn bộ TKB & Lịch trực</button>

            <div id="fullTKB" style="display:none; margin-top:14px;"></div>
        </div>
    </div>

    <script>
        /* -------------------------
               Config / dữ liệu mặc định
               ------------------------- */
        const API_URL = "https://script.google.com/macros/s/AKfycbw5sjUwJfwRtKBQQu5FgYrmgSjoQ22vvnmlv99H7YJHTVgVZRXm1vWB7fFJg8B2O2M7/exec";

        const TKB = {
            0: ["Chủ nhật: Nghỉ / Tự học"],
            1: ["HĐTN,HN(CC)", "LS&ĐL - lịch sử", "Tiếng anh", "LS&ĐL - Địa lí", "Toán học - đại số"],
            2: ["Ngữ văn", "Tiếng anh", "Công nghệ", "HĐTN,HN", "GDTC"],
            3: ["Ngữ văn", "Toán học - hình học", "KHTN - Vật lý", "NT - Mĩ thuật", "KHTN - Sinh học"],
            4: ["Toán học - đại Số", "Tin học", "LS&ĐL - lịch sử", "Âm nhạc", "Tiếng anh"],
            5: ["GDĐP", "Ngữ văn", "HĐTN,HN", "Toán học - hình học", "Giáo dục công dân"],
            6: ["KHTN - Sinh học", "GDTC", "Ngữ văn", "KHTN - Hóa học", "Nghỉ"]
        };

        // Lịch trực (có lưu localStorage nếu user chỉnh)
        let truc = JSON.parse(localStorage.getItem('lichTruc') || 'null') || {
            0: "Chủ nhật: Không trực",
            1: "Tổ 2",
            2: "Tổ 3",
            3: "Tổ 4",
            4: "Tổ 1",
            5: "Tổ 2",
            6: "Tổ 3",
        };

        const dayNames = ["Chủ Nhật", "Thứ Hai", "Thứ Ba", "Thứ Tư", "Thứ Năm", "Thứ Sáu", "Thứ Bảy"];

        /* -------------------------
           Menu
           ------------------------- */
        const menuBtn = document.getElementById('menuBtn');
        const menuPanel = document.getElementById('menuPanel');

        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            menuPanel.style.display = menuPanel.style.display === 'block' ? 'none' : 'block';
        });
        window.addEventListener('click', (ev) => {
            if (!menuPanel.contains(ev.target) && ev.target !== menuBtn) menuPanel.style.display = 'none';
        });

        // Dark toggle in menu:
        const menuDark = document.getElementById('menuDark');

        function applyThemeFromStorage() {
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark');
                menuDark.textContent = '☀️ Light Mode';
            } else {
                document.body.classList.remove('dark');
                menuDark.textContent = '🌙 Dark Mode';
            }
        }
        applyThemeFromStorage();
        menuDark.addEventListener('click', () => {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
            applyThemeFromStorage();
        });

        // Report from menu & fixed button
        const menuReport = document.getElementById('menuReport');
        const reportFixed = document.getElementById('reportFixed');

        async function doReport() {
            const txt = prompt("❗Nhập nội dung báo lỗi / góp ý:");
            if (!txt || !txt.trim()) {
                alert("⚠️ Bạn chưa nhập nội dung.");
                return;
            }
            try {
                // gửi lên API nếu bạn có deploy; nếu không có thì thử-catch vẫn ok
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        text: txt
                    })
                });
                alert("✅ Đã gửi. Cảm ơn bạn!");
            } catch (e) {
                console.warn('Report failed (demo):', e);
                alert("✅ (Demo) Đã ghi nhận: " + txt);
            }
        }
        menuReport.addEventListener('click', doReport);
        if (reportFixed) {
            reportFixed.addEventListener('click', doReport);
        }
        // Show popup from menu
        document.getElementById('menuPopup').addEventListener('click', () => {
            openPopup(true);
            menuPanel.style.display = 'none';
        });

        /* -------------------------
           Popup logic (1 lần/ngày + "Không hiện hôm nay")
           ------------------------- */
        const popup = document.getElementById('popup');
        const popupClose = document.getElementById('popupClose');
        const dontShowTodayChk = document.getElementById('dontShowToday');

        function openPopup(force = false) {
            const today = new Date().toLocaleDateString('vi-VN');
            const disabled = localStorage.getItem('popupDisabled') === 'true'; // nếu user tắt hoàn toàn (không dùng ở đây)
            if (force) {
                popup.classList.add('open');
                return;
            }
            if (disabled) return;
            const lastShown = localStorage.getItem('popupShownDate');
            if (lastShown !== today) {
                popup.classList.add('open');
                localStorage.setItem('popupShownDate', today);
            }
        }

        popupClose.addEventListener('click', () => {
            if (dontShowTodayChk.checked) {
                localStorage.setItem('popupShownDate', new Date().toLocaleDateString('vi-VN'));
            }
            popup.classList.remove('open');
        });

        // show on load
        window.addEventListener('load', () => openPopup(false));

        /* -------------------------
           TKB rendering + full view + editing trực
           ------------------------- */
        function computeShowDay() {
            // Lấy giờ VN
            const vnNow = new Date(new Date().toLocaleString('en-US', {
                timeZone: 'Asia/Ho_Chi_Minh'
            }));
        }

        // NOTE: small helper: get VN date/time (works cross-browser)
        function getVNDateObj() {
            const s = new Date().toLocaleString('en-US', {
                timeZone: 'Asia/Ho_Chi_Minh'
            });
            return new Date(s);
        }

        function renderTodayTKB() {
                const d = getVNDateObj();
                let day = d.getDay(); // 0..6
                const hour = d.getHours();

                // nếu trước 7h thì coi như ngày hôm trước
                if (hour < 7) day = (day - 1 + 7) % 7;

                // logic hiển thị: Thứ Sáu -> hiện Thứ Bảy; Chủ Nhật -> hiện Thứ Hai; khác -> ngày mai
                let showDay;
                if (day === 5) showDay = 6;
                else if (day === 0) showDay = 1;
                else showDay = (day + 1) % 7;

                const container = document.getElementById('todayTKB');
                let html = `<p>Hôm nay: <strong>${dayNames[d.getDay()]}</strong>, ${d.toLocaleDateString('vi-VN')} — Hiển thị TKB <strong>${dayNames[showDay]}</strong></p>`;
                html += `<div class="inline-note">❗Lưu ý: Sau 7:00 sáng TKB & lịch trực sẽ chuyển sang ngày tiếp theo (một vài quy tắc đặc biệt được áp dụng).</div>`;
                html += `<table><thead><tr><th>Tiết</th><th>Môn / Nội dung</th></tr></thead><tbody>`;
                (TKB[showDay] || []).forEach((m, i) => {
                    html += `<tr><td>${i+1}</td><td>${m}</td></tr>`;
                });
                html += `</tbody></table>`;
                html += `<p style="margin-top:10px;"><b>Lịch trực: </b> <span id="todayTruc">${truc[showDay]}</span>`;

                container.innerHTML = html;

                // handle edit trực: mở prompt -> lưu vào truc và localStorage (chỉ admin)
                document.getElementById('editTrucBtn').addEventListener('click', () => {
                    const txt = prompt("Sửa ghi chú lịch trực cho ngày hiển thị:", truc[showDay]);
                    if (txt !== null) {
                        truc[showDay] = txt;
                        localStorage.setItem('lichTruc', JSON.stringify(truc));
                        renderTodayTKB(); // rerender để cập nhật
                    }
                });
            }
            // full week + inline chỉnh trực của từng ngày
        document.getElementById('showFullBtn').addEventListener('click', function() {
            const full = document.getElementById('fullTKB');
            if (full.style.display === 'block') {
                full.style.display = 'none';
                this.textContent = '📅 Xem toàn bộ TKB & Lịch trực';
                return;
            }
            // build full
            let html = `<div style="margin-bottom:8px;"><strong>📅 Thời khóa biểu cả tuần</strong></div>`;
            for (let k = 1; k <= 6; k++) {
                html += `<h3 style="margin:8px 0 4px;">${dayNames[k]}</h3>`;
                html += `<table><thead><tr><th>Tiết</th><th>Môn</th></tr></thead><tbody>`;
                (TKB[k] || []).forEach((m, i) => html += `<tr><td>${i+1}</td><td>${m}</td></tr>`);
                html += `</tbody></table>`;
            }

            // một bảng riêng cho lịch trực
            html += `<hr style="opacity:.08;margin:12px 0;"><h3>🧹 Lịch trực cả tuần</h3>`;
            html += `<table><thead><tr><th>Ngày</th><th>Tổ trực</th></tr></thead><tbody>`;
            for (let k = 1; k <= 6; k++) {
                html += `<tr><td>${dayNames[k]}</td><td class="editable-truc" data-day="${k}">${truc[k]}</td></tr>`;
            }
            html += `</tbody></table>`;

            full.innerHTML = html;
            full.style.display = 'block';
            this.textContent = '❌ Ẩn toàn bộ';
            // save buttons
            full.querySelectorAll('.save-truc').forEach(btn => {
                btn.addEventListener('click', () => {
                    const day = btn.dataset.day;
                    const val = prompt("Nhập nội dung trực cho " + dayNames[day], truc[day]);
                    if (val !== null) {
                        truc[day] = val;
                        localStorage.setItem('lichTruc', JSON.stringify(truc));
                        renderTodayTKB();
                        // refresh full view
                        document.getElementById('showFullBtn').click();
                        document.getElementById('showFullBtn').click();
                    }
                });
            });
        });

        // init render
        renderTodayTKB();

        // re-render every minute (keeps up-to-date at 7:00 change)
        setInterval(renderTodayTKB, 60 * 1000);

        /* -------------------------
          Small accessibility: close menu with ESC
        ------------------------- */
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.getElementById('menuPanel').style.display = 'none';
                document.getElementById('popup').classList.remove('open');
            }
        });
    </script>
</body>

</html>
