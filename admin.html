<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Admin</title>
  <link rel="stylesheet" href="admin.css"> 
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçé</text></svg>">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.3/dist/umd/supabase.min.js"></script>
</head>

<script>
  const SUPABASE_URL = "https://nlmwiyoplederbthjvzz.supabase.co"; 
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sbXdpeW9wbGVkZXJidGhqdnp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MzYxOTEsImV4cCI6MjA3ODQxMjE5MX0.fzyVeeLaSnYJyaIv63i9C7q6C-9UqtmL1HZuNYP-FJE";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
</script>

<body>
  
  <div class="macos-wallpaper"></div>

  <div id="login-box" class="login-container fade-in">
    <div class="login-glass">
      <div class="user-avatar"><span>üë§</span></div>
      <h2 class="user-name">Administrator</h2>
      <form id="loginForm">
        <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" required autocomplete="username" class="mac-input">
        <div class="password-wrapper">
          <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" required autocomplete="current-password" class="mac-input">
          <button type="submit" class="login-arrow">‚ûî</button>
        </div>
      </form>
      <p id="loginMsg"></p>
    </div>
  </div>

  <div id="admin-panel" style="display:none;">
    <div class="mac-window">
      
      <aside class="mac-sidebar">
        <div class="traffic-lights">
          <span class="light red"></span><span class="light yellow"></span><span class="light green"></span>
        </div>
        <div class="sidebar-title">System Settings</div>
        <nav class="admin-nav desktop-only">
          <button class="nav-tab active" data-tab="tab-btvn"><span class="icon">üìù</span> BTVN</button>
          <button class="nav-tab" data-tab="tab-tkb"><span class="icon">üìÖ</span> Th·ªùi Kh√≥a Bi·ªÉu</button>
          <button class="nav-tab" data-tab="tab-changelog"><span class="icon">üìú</span> Changelog</button>
          <button class="nav-tab" data-tab="tab-data"><span class="icon">üìä</span> D·ªØ li·ªáu</button>
        </nav>
        <div class="sidebar-footer">
           <button id="darkModeToggle" class="mac-action-btn">üåô</button>
           <button id="liquidToggle" class="mac-action-btn" title="Ch·∫ø ƒë·ªô K√≠nh L·ªèng">üíß</button> <button id="shortcutBtn" class="mac-action-btn" title="Ph√≠m t·∫Øt">‚å®Ô∏è</button>
           <button id="logoutBtn" class="mac-action-btn danger">üõë</button>
        </div>
      </aside>

      <main class="mac-content">
        <header class="content-header">
          <h1 id="pageTitle">Qu·∫£n l√Ω BTVN</h1>
  
            <div class="header-actions mobile-only">
              
              <button id="mobileDarkBtn" class="mac-btn icon-only" title="Giao di·ªán t·ªëi">üåô</button>
              <button id="mobileShortcutBtn" class="mac-btn icon-only" title="Ph√≠m t·∫Øt">‚å®Ô∏è</button>
            </div>
        </header>

        <div class="scrollable-content" id="mainScroll">
          
          <section id="tab-btvn" class="admin-tab-content active fade-in">
            <div class="mac-card">
              <form id="btvnForm">
                <div class="form-group">
                  <label>M√¥n h·ªçc</label>
                  <div class="select-wrapper">
                    <select id="subject" required>
                      <option value="">-- Ch·ªçn m√¥n --</option>
                      <option value="To√°n h·ªçc - ƒê·∫°i s·ªë">To√°n h·ªçc - ƒê·∫°i s·ªë</option>
                      <option value="To√°n h·ªçc - H√¨nh h·ªçc">To√°n h·ªçc - H√¨nh h·ªçc</option>
                      <option value="Ng·ªØ vƒÉn">Ng·ªØ vƒÉn</option>
                      <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
                      <option value="V·∫≠t l√Ω">V·∫≠t l√Ω</option>
                      <option value="H√≥a h·ªçc">H√≥a h·ªçc</option>
                      <option value="Sinh h·ªçc">Sinh h·ªçc</option>
                      <option value="L·ªãch s·ª≠">L·ªãch s·ª≠</option>
                      <option value="ƒê·ªãa l√≠">ƒê·ªãa l√≠</option>
                      <option value="GDCD">GDCD</option>
                      <option value="Tin h·ªçc">Tin h·ªçc</option>
                      <option value="C√¥ng ngh·ªá">C√¥ng ngh·ªá</option>
                      <option value="GDTC">GDTC</option>
                      <option value="GDƒêP">GDƒêP</option>
                      <option value="Mƒ© thu·∫≠t">Mƒ© thu·∫≠t</option>
                      <option value="√Çm nh·∫°c">√Çm nh·∫°c</option>
                      <option value="HƒêTN">HƒêTN</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label>N·ªôi dung</label>
                  <textarea id="btvn_content" class="auto-expand" placeholder="Nh·∫≠p n·ªôi dung..." rows="5" required></textarea>
                  <small style="color:var(--text-secondary); font-size: 0.8rem;">G·ª£i √Ω: G√µ 'kbt' -> 'Kh√¥ng c√≥ b√†i t·∫≠p'</small>
                </div>
                <div class="btn-group">
                  <button type="button" id="updateBTVN" class="mac-btn primary">Th√™m m·ªõi</button>
                  <button type="button" id="addNewBTVN" class="mac-btn secondary">Ghi ƒë√®</button>
                </div>
              </form>
            </div>
          </section>

          <section id="tab-tkb" class="admin-tab-content fade-in">
            <div class="mac-card">
              <form id="tkbForm">
                <div class="tkb-controls-mac">
                  <div class="control-group-mobile">
                    <div class="control-item">
                        <label>Th·ª©</label>
                        <select id="tkb_day" required>
                        <option value="">Ch·ªçn...</option>
                        <option value="1">Th·ª© 2</option>
                        <option value="2">Th·ª© 3</option>
                        <option value="3">Th·ª© 4</option>
                        <option value="4">Th·ª© 5</option>
                        <option value="5">Th·ª© 6</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>T·ªï tr·ª±c</label>
                        <select id="tkb_truc" required>
                        <option value="">Ch·ªçn...</option>
                        <option value="T·ªï 1">T·ªï 1</option>
                        <option value="T·ªï 2">T·ªï 2</option>
                        <option value="T·ªï 3">T·ªï 3</option>
                        <option value="T·ªï 4">T·ªï 4</option>
                        </select>
                    </div>
                  </div>
                  <button type="button" id="updateTrucOnly" class="mac-btn secondary small full-width-mobile">
                    C·∫≠p nh·∫≠t m·ªói T·ªï Tr·ª±c
                  </button>
                </div>

                <div class="tkb-split-view">
                  <div class="tkb-column">
                    <h3>S√°ng</h3>
                    <div id="tkb-sang-container" class="tkb-list"></div>
                  </div>
                  <div class="tkb-column">
                    <h3>Chi·ªÅu</h3>
                    <div id="tkb-chieu-container" class="tkb-list"></div>
                  </div>
                </div>
                <div class="form-actions right">
                  <button type="button" id="updateTKB" class="mac-btn primary full-width-mobile">L∆∞u TKB</button>
                </div>
              </form>
            </div>
          </section>

          <section id="tab-changelog" class="admin-tab-content fade-in">
            <div class="mac-card">
              <form id="changelogForm">
                <div class="form-group">
                  <label>N·ªôi dung (ƒê√£ h·ªó tr·ª£ g√µ t·∫Øt!)</label>
                  <textarea id="changelog_text" class="auto-expand" placeholder="N·ªôi dung..." rows="6" required></textarea>
                </div>
                <div class="btn-group">
                  <button type="button" id="updateChangelog" class="mac-btn primary">Ghi ƒë√® (Gi·ªØ c≈©)</button>
                  <button type="button" id="addNewChangelog" class="mac-btn secondary">Th√™m m·ªõi (X√≥a c≈©)</button>
                </div>
              </form>
            </div>
          </section>

          <section id="tab-data" class="admin-tab-content fade-in">
            <div class="mac-card">
              <button id="refreshData" class="mac-btn small">üîÑ T·∫£i l·∫°i</button>
              <div class="code-block-wrapper">
                <pre id="dataViewer" class="data-viewer">Loading...</pre>
              </div>
            </div>
          </section>

        </div> </main>
    </div>
  </div>

  <nav class="mobile-bottom-nav">
    <button class="nav-tab active" data-tab="tab-btvn">
      <span class="icon">üìù</span>
      <span class="label">BTVN</span>
    </button>
    <button class="nav-tab" data-tab="tab-tkb">
      <span class="icon">üìÖ</span>
      <span class="label">TKB</span>
    </button>
    <button class="nav-tab" data-tab="tab-changelog">
      <span class="icon">üìú</span>
      <span class="label">Log</span>
    </button>
    <button class="nav-tab" data-tab="tab-data">
      <span class="icon">üìä</span>
      <span class="label">Data</span>
    </button>
    <button class="nav-tab" id="mobileLogout"> 
        <span class="icon">‚öôÔ∏è</span>
        <span class="label">Tho√°t</span>
    </button>
</nav>

<div id="confirmModal" class="modal">
    <div class="modal-content mac-card">
      <div class="modal-header">
        <h3>‚ö†Ô∏è X√°c nh·∫≠n g·ª≠i</h3>
        <span class="close-modal" data-target="confirmModal">&times;</span>
      </div>
      <div class="modal-body">
        <p>H·ªá th·ªëng ƒë√£ t·ª± ƒë·ªông x·ª≠ l√Ω c√°c t·ª´ vi·∫øt t·∫Øt. Vui l√≤ng ki·ªÉm tra l·∫°i n·ªôi dung tr∆∞·ªõc khi g·ª≠i:</p>
        
        <div class="confirm-preview">
          <label>M√¥n h·ªçc:</label>
          <div id="previewSubject" class="preview-box bold"></div>
        </div>
        
        <div class="confirm-preview">
          <label>N·ªôi dung chi ti·∫øt:</label>
          <pre id="previewContent" class="preview-box"></pre>
        </div>

        <div class="modal-actions">
          <button id="cancelSend" class="mac-btn secondary">H·ªßy b·ªè</button>
          <button id="confirmSend" class="mac-btn primary">üöÄ G·ª≠i ngay</button>
        </div>
      </div>
    </div>
  </div>

  <div id="shortcutModal" class="modal">
    <div class="modal-content mac-card">
      <div class="modal-header">
        <h3>‚å®Ô∏è B·∫£ng m√£ ph√≠m t·∫Øt</h3>
        <span class="close-modal" data-target="shortcutModal">&times;</span>
      </div>
      <div class="modal-body">
        <p>G√µ m√£ + d·∫•u c√°ch (ho·∫∑c Enter) ƒë·ªÉ t·ª± ƒë·ªông thay th·∫ø:</p>
        <table class="shortcut-table">
          <thead><tr><th>M√£</th><th>Thay th·∫ø th√†nh</th></tr></thead>
          <tbody id="shortcutTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- NEW: Logout confirmation modal -->
  <div id="logoutModal" class="modal">
    <div class="modal-content mac-card">
      <div class="modal-header">
        <h3>üîí ƒêƒÉng xu·∫•t</h3>
        <span class="close-modal" data-target="logoutModal">&times;</span>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?</p>
        <div class="modal-actions">
          <button id="cancelLogout" class="mac-btn secondary">Kh√¥ng</button>
          <button id="confirmLogout" class="mac-btn primary">X√°c nh·∫≠n</button>
        </div>
      </div>
    </div>
  </div>

  <script>window.isLoading = false;</script>
  <script src="admin.js" defer></script>
</body>
</html>