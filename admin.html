<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - BTVN System</title>
  <link rel="stylesheet" href="admin.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“˜</text></svg>">
  <meta name="description" content="Trang quáº£n trá»‹ há»‡ thá»‘ng BÃ i Táº­p Vá» NhÃ ">
  <!-- Preload resources for better performance -->
  <link rel="preload" href="admin.js" as="script">
</head>
<body>
  <!-- ÄÄƒng nháº­p -->
  <div id="login-box" class="card fade-in">
    <h2>ğŸ”‘ ÄÄƒng nháº­p quáº£n trá»‹</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="TÃªn Ä‘Äƒng nháº­p" required autocomplete="username">
      <input type="password" id="password" placeholder="Máº­t kháº©u" required autocomplete="current-password">
      <button type="submit" id="loginBtn">ÄÄƒng nháº­p</button>
    </form>
    <p id="loginMsg"></p>
  </div>

  <!-- Admin panel -->
  <div id="admin-panel" style="display:none;">
    <header>
      <h1>Trang Quáº£n Trá»‹ BTVN</h1>
      <div style="display: flex; align-items: center; gap: 10px;">
        <button id="darkModeToggle" class="dark-toggle" aria-label="Chuyá»ƒn Ä‘á»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i">
          <span id="modeIcon">ğŸŒ™</span>
        </button>
        <button id="logoutBtn" aria-label="ÄÄƒng xuáº¥t">ÄÄƒng xuáº¥t</button>
      </div>
    </header>

    <main class="container">
      <!-- BTVN -->
      <section class="card fade-in">
        <h2>ğŸ“ BÃ i Táº­p Vá» NhÃ </h2>
        <form id="btvnForm">
          <label for="subject">MÃ´n há»c</label>
          <select id="subject" required>
            <option value="">-- Chá»n mÃ´n há»c --</option>
            <option value="ToÃ¡n - Äáº¡i sá»‘">ToÃ¡n - Äáº¡i sá»‘</option>
            <option value="ToÃ¡n - HÃ¬nh há»c">ToÃ¡n - HÃ¬nh há»c</option>
            <option value="Ngá»¯ vÄƒn">Ngá»¯ vÄƒn</option>
            <option value="Tiáº¿ng Anh">Tiáº¿ng Anh</option>
            <option value="Váº­t lÃ½">Váº­t lÃ½</option>
            <option value="HÃ³a há»c">HÃ³a há»c</option>
            <option value="Sinh há»c">Sinh há»c</option>
            <option value="Lá»‹ch sá»­">Lá»‹ch sá»­</option>
            <option value="Äá»‹a lÃ­">Äá»‹a lÃ­</option>
            <option value="GDCD">GDCD</option>
            <option value="Tin há»c">Tin há»c</option>
            <option value="CÃ´ng nghá»‡">CÃ´ng nghá»‡</option>
            <option value="GDTC">GDTC</option>
            <option value="GDÄP">GDÄP</option>
            <option value="MÄ© thuáº­t">MÄ© thuáº­t</option>
            <option value="Ã‚m nháº¡c">Ã‚m nháº¡c</option>
            <option value="HÄTN">HÄTN</option>
          </select>
          <label for="btvn_content">Ná»™i dung</label>
          <textarea id="btvn_content" placeholder="Ná»™i dung bÃ i táº­p" rows="4" required></textarea>
          <div class="btn-group">
            <button type="button" id="updateBTVN" class="btn-update">â• ThÃªm má»›i</button>
            <button type="button" id="addNewBTVN" class="btn-new">ğŸ” Cáº­p nháº­t (ghi Ä‘Ã¨)</button>
          </div>
        </form>
      </section>

      <!-- TKB -->
      <section class="card fade-in">
        <h2>ğŸ“… Thá»i KhoÃ¡ Biá»ƒu</h2>
        <form id="tkbForm">
          <label for="tkb_day">Chá»n thá»©</label>
          <select id="tkb_day" required>
            <option value="">-- Chá»n thá»© --</option>
            <option value="1">Thá»© 2</option>
            <option value="2">Thá»© 3</option>
            <option value="3">Thá»© 4</option>
            <option value="4">Thá»© 5</option>
            <option value="5">Thá»© 6</option>
          </select>

          <label for="tkb_truc">Tá»• trá»±c trong ngÃ y</label>
          <select id="tkb_truc" required>
            <option value="">-- Chá»n tá»• trá»±c --</option>
            <option value="Tá»• 1">Tá»• 1</option>
            <option value="Tá»• 2">Tá»• 2</option>
            <option value="Tá»• 3">Tá»• 3</option>
            <option value="Tá»• 4">Tá»• 4</option>
          </select>

          <div id="periodsContainer"></div>
          <button type="button" id="addPeriod">â• ThÃªm tiáº¿t</button>

          <div class="btn-group mt-20">
            <button type="button" id="updateTKB" class="btn-update">ğŸ” Cáº­p nháº­t (ghi Ä‘Ã¨)</button>
            <button type="button" id="addNewTKB" class="btn-new">â• ThÃªm má»›i (xoÃ¡ toÃ n bá»™ ngÃ y cÅ©)</button>
          </div>
        </form>
      </section>

      <!-- Changelog -->
      <section class="card fade-in">
        <h2>ğŸ“œ Cáº­p nháº­t thay Ä‘á»•i</h2>
        <form id="changelogForm">
          <label for="changelog_text">Ná»™i dung changelog</label>
          <textarea id="changelog_text" placeholder="Nháº­p ná»™i dung changelog..." rows="4" required></textarea>
          <div class="btn-group">
            <button type="button" id="updateChangelog" class="btn-update">ğŸ” Ghi Ä‘Ã¨</button>
            <button type="button" id="addNewChangelog" class="btn-new">â• ThÃªm má»›i</button>
          </div>
        </form>
      </section>

      <!-- Data viewer -->
      <section class="card fade-in">
        <h2>ğŸ“Š Xem dá»¯ liá»‡u</h2>
        <button id="refreshData">Táº£i láº¡i</button>
        <pre id="dataViewer" class="data-viewer">(chÆ°a táº£i)</pre>
      </section>
    </main>
  </div>

  <script>
    // ThÃªm biáº¿n toÃ n cá»¥c Ä‘á»ƒ theo dÃµi tráº¡ng thÃ¡i táº£i
    window.isLoading = false;
    // Cáº¥u hÃ¬nh (lÆ°u hash chá»© khÃ´ng lÆ°u máº­t kháº©u plaintext)
    const CONFIG = {
      SCRIPT_URL: "https://script.google.com/macros/s/AKfycbwEVbGj72KB2zZQbrTaqWqEGAVVirGBuel-NjOlKgq230fdOx31ciN0783sO1EQTq16/exec",
      // ... cÃ¡c cáº¥u hÃ¬nh khÃ¡c báº¡n Ä‘ang dÃ¹ng
      ADMIN_USERNAME: "admin",
      // Thay báº±ng hash báº¡n Ä‘Ã£ táº¡o
      ADMIN_PASSWORD_HASH: "329fe68c81dcc05dec93329dd35760318da604549107ec7ccb81d3a7545f54f4",
      TOAST_DURATION: 3000,
      // ... giá»¯ láº¡i cÃ¡c config khÃ¡c náº¿u cÃ³
    };

    // HÃ m bÄƒm SHA-256 tráº£ vá» hex string
    async function sha256Hex(str) {
      const enc = new TextEncoder();
      const data = enc.encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // VÃ­ dá»¥ dÃ¹ng trong xá»­ lÃ½ login (giáº£ sá»­ báº¡n Ä‘Ã£ cache cÃ¡c element DOM)
    async function handleLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value; // váº«n láº¥y input ngÆ°á»i dÃ¹ng

      const enteredHash = await sha256Hex(password);

      if (username === CONFIG.ADMIN_USERNAME && enteredHash === CONFIG.ADMIN_PASSWORD_HASH) {
        localStorage.setItem("adminLogged", "true");
        showAdmin(); // hÃ m hiá»‡n panel admin cá»§a báº¡n
        showToast("ÄÄƒng nháº­p thÃ nh cÃ´ng", "success");
      } else {
        document.getElementById('loginMsg').textContent = "Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!";
        showToast("Sai tÃ i khoáº£n hoáº·c máº­t kháº©u", "error");
      }
    }
  </script>
  <script src="admin.js" defer></script>
</body>
</html>